function GetTopData(){SetCardOverlay($("#combo-bar-line").closest(".card"));$.post("/data/company-person-statistic",function(n){var t={labels:n.labels,datasets:[{type:"bar",label:"Inbound",data:n.inbound,backgroundColor:"#12F8C0",borderColor:"transparent",borderWidth:2},{type:"bar",label:"Outbound",data:n.outbound,backgroundColor:"#FF52A5",borderColor:"transparent",borderWidth:2},{type:"bar",label:"Missed",data:n.missed,backgroundColor:"#FFE37E",borderColor:"transparent",borderWidth:2}]},i={type:"bar",options:MostContactedChartOptions,data:t},r=new Chart(MostContactedChart,i);RemoveCardOverlay($("#combo-bar-line").closest(".card"))})}function DrawPersonalInfo(){var t,n;if(Dt2==undefined)return!1;for(t=Dt2.rows().data(),n=0;n<t.length;n++)connection.invoke("GetExtInfo",t[n].No)}function Connect(){async function n(){try{await connection.start();DrawPersonalInfo()}catch(n){console.log(n)}}connection=(new signalR.HubConnectionBuilder).withUrl("http://"+$("#IpAddress").val()+":8899/myMessageHub").configureLogging(signalR.LogLevel.Information).build();connection.on("ExtInfo",function(n){var t=JSON.parse(n);t.Email!=""&&t.Email!=null&&$("#email-"+t.ExtensionNumber).html('<img src="/app-assets/images/icons/ext-mail.svg">'+t.Email);t.MobileNumber!=""&&t.MobileNumber!=null&&$("#phone-"+t.ExtensionNumber).html('<img src="/app-assets/images/icons/ext-phone.svg">'+t.MobileNumber)});connection.onclose(()=>{await n()});n()}function GetDynimacDataExport(n,t){var i="",e="",s="",o=[],r=[],u,f;if(t.indexOf("<t>")>-1){for(f=/<t>(.*?)<\/t>/ig;u=f.exec(t);)e+=u[1]+",";i=e.split(",")[0];o=e.split(",")}if(t.indexOf("<v>")>-1){for(f=/<v>(.*?)<\/v>/ig;u=f.exec(t);)s+=u[1]+",";r=s.split(",")}$.isNumeric(i)?o.splice(0,1):(i=r[0],r.splice(0,1));var h='<c t="inlineStr" r="A'+n+'"><is><t>'+i+'<\/t><\/is><\/c><c t="inlineStr" r="B'+n+'"><is><t>'+o[0]+"<\/t><\/is><\/c>",c='<c t="inlineStr" r="C'+n+'"><is><t>'+RegexHtmlTag($("#email-"+i).html())+'<\/t><\/is><\/c><c t="inlineStr" r="D'+n+'"><is><t>'+RegexHtmlTag($("#phone-"+i).html())+"<\/t><\/is><\/c>",l='<c t="inlineStr" r="E'+n+'"><is><t>'+r[0]+'<\/t><\/is><\/c><c t="inlineStr" r="F'+n+'"><is><t>'+r[1]+'<\/t><\/is><\/c><c t="inlineStr" r="G'+n+'"><is><t>'+r[2]+"<\/t><\/is><\/c>";return console.log(h+c+l),h+c+l}function RegexHtmlTag(n){if(console.log(n),n!==""&&n!=undefined)return n.replace(/(<([^>]+)>)/ig,"");return""}var MostContactedChart,MostContactedChartOptions,Dt2,connection;$(window).on("load",function(){MostContactedChart=$("#combo-bar-line");MostContactedChartOptions={responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{display:!0,gridLines:{color:"#f3f3f3",drawTicks:!1},scaleLabel:{display:!1,labelString:"Tüm Dahililer"},ticks:{padding:15}}],yAxes:[{display:!0,gridLines:{color:"#f3f3f3",drawTicks:!1},scaleLabel:{display:!1,labelString:"Çağrı Sayısı"}}]},onClick:function(n,t){e=t[0];var i=this.data.labels[e._index];window.location.href="/company-user-detail/"+i.split("-")[0]}};GetTopData()});$(function(){Connect()});Dt2=$("#CompanyPersonTable").DataTable({processing:!0,pageLength:20,ajax:{url:"/data/company-person",type:"POST",datatype:"json",data:{NS:$("#name-surname").val()},dataSrc:function(n){for(var r,i=[],t=0;t<n.length;t++)r={No:n[t].dn,NameSurname:'<img class="mr-1" src="/app-assets/images/icons/user-to.svg">'+n[t].display_name,Email:'<div class="person-email" id="email-'+n[t].dn+'"><\/div>',Phone:'<div class="person-phone" id="phone-'+n[t].dn+'"><\/div>',TotalInbound:n[t].totalinbound>0?'<span style="font-weight:bold; color:#00b392">'+n[t].totalinbound+"<\/span>":n[t].totalinbound,TotalOutbound:n[t].totaloutbound>0?'<span style="font-weight:bold; color:#FF0266">'+n[t].totaloutbound+"<\/span>":n[t].totaloutbound,TotalMissed:n[t].totalmissed>0?'<span style="font-weight:bold; color:#FF8C4B">'+n[t].totalmissed+"<\/span>":n[t].totalmissed,Button:'<a class="CallDetailsButton" href="/company-user-detail/'+n[t].dn+'"> <img src="/app-assets/images/icons/eye-table.svg"><\/a>'},i.push(r);return i}},columns:[{data:"No"},{data:"NameSurname"},{data:"Email"},{data:"Phone"},{data:"TotalInbound"},{data:"TotalOutbound"},{data:"TotalMissed"},{data:"Button"}],fnDrawCallback:function(){DrawPersonalInfo()},initComplete:function(){setTimeout(function(){Dt2.columns.adjust().responsive.recalc()},5e3)},bLengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excelHtml5",exportOptions:{columns:[0,1,2,3,4,5,6]},customize:function(n){var e=n.xl.worksheets["sheet1.xml"],i=$("row",e),r=[],u,f,t;for(r.push(i[0].outerHTML),r.push(i[1].outerHTML),t=2;t<i.length;t++)u=i[t].outerHTML,u='<row r="'+(t+1)+'">',u+=GetDynimacDataExport(t+1,i[t].outerHTML),u+="<\/row>",r.push(u);for(f="",t=0;t<r.length;t++)f+=r[t];e.childNodes[0].childNodes[1].innerHTML=f;$("#CompanyPersonTable").DataTable().page.len(20).draw()}}],language:{sEmptyTable:Localization.sEmptyTable,sInfo:Localization.sInfo,sInfoEmpty:Localization.sInfoEmpty,sInfoFiltered:Localization.sInfoFiltered,sLengthMenu:Localization.sLengthMenu,sLoadingRecords:Localization.sLoadingRecords,sSearch:Localization.sSearch,sZeroRecords:Localization.sZeroRecords,oPaginate:{sFirst:Localization.sFirst,sLast:Localization.sLast,sNext:Localization.sNext,sPrevious:Localization.sPrevious}},oLanguage:{sProcessing:'<span class="load load-button"><\/span>'},responsive:!0,autoWidth:!1});$(".exportExcel").click(function(){$("#CompanyPersonTable").DataTable().page.len(2e3).draw();setTimeout(function(){Dt2.button(".buttons-excel").trigger()},500)});