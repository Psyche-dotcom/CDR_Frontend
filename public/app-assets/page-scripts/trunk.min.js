function Connect(){async function t(){try{await n.start();$("#AgentBusyButton").click(function(){n.invoke("GetSipInfo").catch(n=>console.error(n))})}catch(t){console.log(t)}}const n=(new signalR.HubConnectionBuilder).withUrl("http://"+$("#IpAddress").val()+":8899/myMessageHub").configureLogging(signalR.LogLevel.Information).build();n.on("ServerMessage",function(n){GetData(n);_isStart&&StartTrunk()});n.onclose(()=>{await t()});t()}function GetData(n){var t=JSON.parse(n);AllTrunksActiveCalls=t.AllTrunksActiveCalls;AllTrunksInfo=t.AllTrunksInfo}function StartTrunk(){var n,t,i;if($(".trunk-container").html('<img src="/app-assets/images/loading.gif" style="display:block;margin:0 auto;width:64px;height:64px;" id="LoadingGif" />'),DrawTrunk(!0,{}),VisibleTrunks.length==0)AllTrunksInfo[0]!=null&&AllTrunksInfo[0]!=undefined&&DrawTrunk(!1,AllTrunksInfo[0]),AllTrunksInfo[1]!=null&&AllTrunksInfo[1]!=undefined&&DrawTrunk(!1,AllTrunksInfo[1]),AllTrunksInfo[2]!=null&&AllTrunksInfo[2]!=undefined&&DrawTrunk(!1,AllTrunksInfo[2]);else for(n=0;n<AllTrunksInfo.length;n++)for(t=0;t<VisibleTrunks.length;t++)if(i=AllTrunksInfo[n].indexOf(VisibleTrunks[t]+",")>-1,i){DrawTrunk(!1,AllTrunksInfo[n]);break}DrawModalTrunk();_isStart=!1;$("#LoadingGif").remove()}function DrawTrunk(n,t){var f,e=0,u;if(n){var o=0,s=0,h=0;for(u=0;u<AllTrunksInfo.length;u++){var i=AllTrunksInfo[u].split(","),c=parseInt(i[3].split(":")[1]),l=parseInt(i[4].split(":")[1]),a=parseInt(i[5].split(":")[1]);o+=l;s+=a;h+=c}f=` <div class="col-xl-3 col-md-6 column" id="trunk-item-all">
            <div class="card pull-up bg-hexagons trunk-card-design">
                <div class="card-header" style="background: none">
                    <h4 class="card-title"><span class="danger">1.</span>  ${Localization.AllTrunks}</h4>
                    <a class="btn btn-sm TrunkDetailButton" style="float: right;" data-item="-1" data-name="All Trunks"><img src="/app-assets/images/icons/detail-button.svg" /></a>

                </div>
                <div class="card-content collapse show">
                    <div class="card-body pt-0">
                        <h1 style="font-size: 100px;" class="trunk-active">${h}</h1>
                        <div class="trunk-inbound-number">
                            <img src="/app-assets/images/icons/inbound-trunk.svg" /></i> <h2 style="color:#9196e3 !important" class="trunk-inbound">${o}</h2>
                        </div>
                        <div class="trunk-inbound-number">
                            <img src="/app-assets/images/icons/outbound-trunk.svg" /></i><h2 style="color:#e36496 !important" class="trunk-outbound">${s}</h2>
                        </div>
                       
                        <div class="clearfix"></div>
                        <section class="trunk-chart-div">
                            <div id="chartdiv-all"></div>
                        </section>
                    </div>
                </div>
            </div>
        </div>`}else{var i=t.split(","),v=i[0].split(":")[1],r=i[1].split(":")[1],c=i[3].split(":")[1],l=i[4].split(":")[1],a=i[5].split(":")[1];f=` <div class="col-xl-3 col-md-6 column" id="trunk-item-${r}">
            <div class="card pull-up bg-hexagons trunk-card-design">
                <div class="card-header" style="background: none">
                    <h4 class="card-title"><span class="danger">${$(".trunk-container .column").length+1}.</span>  ${v}</h4>
                    <a class="btn btn-sm TrunkDetailButton" style="float: right;" data-item="${r}" data-name="${v}"><img src="/app-assets/images/icons/detail-button.svg" /></a>
                </div>
                <div class="card-content collapse show">
                    <div class="card-body pt-0">
                        <h1 style="font-size: 100px;" class="trunk-active">${c}</h1>
                        <div class="trunk-inbound-number">
                            <img src="/app-assets/images/icons/inbound-trunk.svg" /> <h2 style="color:#9196e3 !important" class="trunk-inbound">${l}</h2>
                        </div>
                        <div class="trunk-inbound-number">
                            <img src="/app-assets/images/icons/outbound-trunk.svg" /> <h2 style="color:#e36496 !important" class="trunk-outbound">${a}</h2>
                        </div>
                        
                        <div class="clearfix"></div>
                        <section class="trunk-chart-div">
                            <div id="chartdiv-${r}"></div>
                        </section>
                    </div>
                </div>
            </div>
        </div>`;_isStart&&VisibleTrunks.push(r);e=r}$(".trunk-container").append(f);DrawGraph(e)}function SocketTrunkTotals(){for(var i,r,f=0,e=0,h=0,n=0;n<AllTrunksInfo.length;n++){var t=AllTrunksInfo[n].split(","),c=parseInt(t[3].split(":")[1]),o=parseInt(t[4].split(":")[1]),s=parseInt(t[5].split(":")[1]);f+=o;e+=s;h+=c}for($("#trunk-item-all .trunk-active").html(h),$("#trunk-item-all .trunk-inbound").html(f),$("#trunk-item-all .trunk-outbound").html(e),i=$.grep(ChartList,function(n){return n.Id===0}),i.length>0&&(i[0].Chart.data[0].value=e,i[0].Chart.data[1].value=f,i[0].Chart.invalidateRawData()),n=0;n<AllTrunksInfo.length;n++){var t=AllTrunksInfo[n].split(","),u=t[1].split(":")[1],c=parseInt(t[3].split(":")[1]),o=parseInt(t[4].split(":")[1]),s=parseInt(t[5].split(":")[1]);$("#trunk-item-"+u+" .trunk-active").html(c);$("#trunk-item-"+u+" .trunk-inbound").html(o);$("#trunk-item-"+u+" .trunk-outbound").html(s);r=$.grep(ChartList,function(n){return n.Id===u.toString()});r.length>0&&(r[0].Chart.data[0].value=s,r[0].Chart.data[1].value=o,r[0].Chart.invalidateRawData())}}function DataTableData(){var n,i,t;if(_dataTable.clear().draw(),SelectedTrunk=="-1")for(n=0;n<AllTrunksActiveCalls.length;n++)t=DataRow(AllTrunksActiveCalls[n]),_dataTable.row.add(t).draw(!1);else for(n=0;n<AllTrunksActiveCalls.length;n++)i=AllTrunksActiveCalls[n].indexOf(SelectedTrunk)>-1,i&&(t=DataRow(AllTrunksActiveCalls[n]),_dataTable.row.add(t).draw(!1))}function DataRow(n){var f=n.split(","),d=f[0].split(":")[1],c=f[1].split(":")[1],l=f[2].split(":")[1],it=f[3].split(":")[1],u=f[4].split(":").slice(1).join(":"),a=f[5].split(":").slice(1).join(":"),v=f[6].split(":")[1],y=f[7].split(":")[1],rt=parseFloat($("#Gmt").val()),g=parseInt(rt),e=rt-g,p,w;e=e*100;e=e.toFixed(2);e=parseInt(e);var lt=u.split(":")[0],at=u.split(":")[1],vt=u.split(":")[2],nt=new TimeSpan(0,vt,at,lt);nt.addHours(-1*g);nt.addMinutes(-1*e);u=nt.toString();p=a.split(" ")[1];w=new TimeSpan(0,p.split(":")[2],p.split(":")[1],p.split(":")[0]);w.addHours(g);w.addMinutes(e);a=a.split(" ")[0]+" "+w.toString();var ut="",b="",ft="",k="",et="",ot="";c.indexOf("(")>-1&&(ut=c.match(/\((.*)\)/).pop(),b=c.split("(")[0],c=b,et=find(AllTrunksInfo,b),y=y==""||y==null?ut:y);l.indexOf("(")>-1&&(ft=l.match(/\((.*)\)/).pop(),k=l.split("(")[0],l=k,ot=find(AllTrunksInfo,k));var yt=ft,pt=et.length>0?b:ot.length>0?k:"",st=u.split(":")[1],t=st!=undefined?parseInt(st):0,ht=u.split(":")[0],tt=ht!=undefined?parseInt(ht):0,i="#a8b6c4",o="normal",s="time-grey.svg",h="0";tt==0?t!=0&&(t>=5&&t<10?(i=_themeColorDuration[1],o="bold",s="time-blue.svg",h="2"):t>=10&&t<20?(i=_themeColorDuration[2],o="bold",s="time-orange.svg",h="3"):t>=20?(i=_themeColorDuration[3],o="bold",s="time-red.svg",h="4"):(i=_themeColorDuration[0],o="bold",s="time-green.svg",h="1")):(i=_themeColorDuration[3],o="bold",s="time-red.svg",h="4",t=t==0?60*tt:60*tt+t);var ct=u.split(":")[2],wt=ct!=undefined?parseInt(ct):0,bt=a.split(" ")[0],kt=a.split(" ")[1],r=[];return r.push(pt),r.push(c),r.push('<img src="/app-assets/images/icons/user-green.svg" />'+y),r.push(it=="Inbound"?'<div class="badge badge-inbound" data-id="'+v+'"><i class="ft-phone-incoming"><\/i> '+Localization.Inbound+"<\/div>":it=="Outbound"?'<div class="badge badge-outbound" data-id="'+v+'"><i class="ft-phone-outgoing"><\/i> '+Localization.Outbound+"<\/div>":""),r.push(l),r.push('<img src="/app-assets/images/icons/user-red.svg" />'+yt),wt==1?r.push('<span class="trunk-duration-number" style="color:'+i+'">'+t+'<\/span><span class="trunk-duration-min"  style="color:'+i+'">'+Localization.TrunkDurationShort+'<\/span ><span class="trunk-duration-time"><img src="/app-assets/images/icons/'+s+'" /> <span class="duration-statue"  data-item="'+h+'" style="color:'+i+"; font-weight:"+o+'">'+u+"<\/span><\/span>"):r.push('<span class="trunk-duration-number" style="color:'+i+'">'+t+'<\/span><span class="trunk-duration-min"  style="color:'+i+'">'+Localization.TrunkDurationShort+'<\/span ><span class="trunk-duration-time"><img src="/app-assets/images/icons/'+s+'" /> <span class="duration-statue"  data-item="'+h+'" style="color:'+i+"; font-weight:"+o+'">'+u+"<\/span><\/span>"),r.push(d=="Connected"?'<div class="badge badge-warning" data-id="'+v+'"><i class="ft-wifi"><\/i> '+Localization.Connected+"<\/div>":d=="Ringing"?'<div class="badge badge-success trunk-status-badge" data-id="'+v+'"><i class="ft-phone-incoming"><\/i> '+Localization.Ringing+"<\/div>":d=="Dialing"?'<div class="badge badge-danger" data-id="'+v+'"><i class="ft-phone-outgoing"><\/i> '+Localization.Dialing+"<\/div>":""),r.push('<div class="trunkstatue-date"><img src="/app-assets/images/icons/Calendar-purple.svg" />'+bt+'<\/div>  <div class="trunkstatue-time"><img src="/app-assets/images/icons/time-date-green.svg"/>'+kt+"<\/div>"),r}function DrawModalTrunk(){var n;for($("#trunk-modal-container").html(""),n=0;n<AllTrunksInfo.length;n++){var t=AllTrunksInfo[n].split(","),r=t[0].split(":")[1],i=t[1].split(":")[1];$("#trunk-modal-container").append('<div class="col-md-6"><fieldset class="checkboxsas"><label><input type="checkbox" class="option-input checkbox" value="'+i+'" '+(VisibleTrunks.indexOf(i)>-1?"checked":"")+"> "+r+"<\/label><\/fieldset><\/div>")}}function DrawGraph(n){var s,f,e,h,t,u,o,i,r;am4core.useTheme(am4themes_animated);s=[];f=new am4core.LinearGradient;f.addColor(am4core.color("#a3a0e4"));f.addColor(am4core.color("#70b0ec"));f.addColor(am4core.color("#00d4ff"));f.rotation=90;e=new am4core.LinearGradient;e.addColor(am4core.color("#ef629f"));e.addColor(am4core.color("#ffd298"));e.rotation=90;s.push(e);s.push(f);h=new am4core.ColorSet;h.list=["#ef629f","#a3a0e4"].map(function(n){return new am4core.color(n)});t=am4core.create("chartdiv-"+(n==0?"all":n),am4charts.RadarChart);t.data=[{category:Localization.Outbound,value:0,full:_simultaneousCalls},{category:Localization.Inbound,value:0,full:_simultaneousCalls}];t.colors=h;t.startAngle=-90;t.endAngle=180;t.innerRadius=am4core.percent(60);t.numberFormatter.numberFormat="";u=t.yAxes.push(new am4charts.CategoryAxis);u.dataFields.category="category";u.renderer.grid.template.location=0;u.renderer.grid.template.strokeOpacity=0;u.renderer.labels.template.horizontalCenter="right";u.renderer.labels.template.fontWeight=500;u.renderer.labels.template.adapter.add("fill",function(n,i){return i.dataItem.index>=0?t.colors.getIndex(i.dataItem.index):n});u.renderer.minGridDistance=20;o=t.xAxes.push(new am4charts.ValueAxis);o.renderer.grid.template.strokeOpacity=0;o.min=0;o.max=_simultaneousCalls;o.strictMinMax=!0;i=t.series.push(new am4charts.RadarColumnSeries);i.dataFields.valueX="full";i.dataFields.categoryY="category";i.clustered=!1;i.columns.template.fill=(new am4core.InterfaceColorSet).getFor("alternativeBackground");i.columns.template.fillOpacity=.08;i.columns.template.cornerRadiusTopLeft=0;i.columns.template.strokeWidth=0;i.columns.template.radarColumn.cornerRadius=80;i.columns.template.width=am4core.percent(80);r=t.series.push(new am4charts.RadarColumnSeries);r.dataFields.valueX="value";r.dataFields.categoryY="category";r.clustered=!1;r.columns.template.strokeWidth=0;r.columns.template.tooltipText="{category}: [bold]{value}[/]";r.columns.template.radarColumn.cornerRadius=80;r.columns.template.width=am4core.percent(80);r.columns.template.adapter.add("fill",function(n,t){return s[t.dataItem.index]});t.cursor=new am4charts.RadarCursor;ChartList.push({Id:n,Chart:t})}function find(n,t){return t=t.split(" "),n.filter(function(n){return t.every(function(t){return n.indexOf(t)>-1})})}var _dataTable=$("#TrunkDataTable").DataTable({createdRow:function(n){$(n).find("td").eq(0).addClass("badge-state-border");var r=$(n).find("div").attr("data-id"),t=$("#trunk-item-"+r).find(".card").css("border-left"),i="#bfbdbd";t!=undefined&&(i=t.split(" ").slice(2).join(" "));$(n).find("td").eq(0).css("border-left","5px solid "+i);$(n).find("td").eq(6).css("padding","0 2rem")},language:{sEmptyTable:Localization.sEmptyTable,sInfo:Localization.sInfo,sInfoEmpty:Localization.sInfoEmpty,sInfoFiltered:Localization.sInfoFiltered,sLengthMenu:Localization.sLengthMenu,sLoadingRecords:Localization.sLoadingRecords,sProcessing:Localization.sProcessing,sSearch:Localization.sSearch,sZeroRecords:Localization.sZeroRecords,oPaginate:{sFirst:Localization.sFirst,sLast:Localization.sLast,sNext:Localization.sNext,sPrevious:Localization.sPrevious}},order:[[8,"asc"]]});$(function(){Connect();setInterval(function(){$("#AgentBusyButton").trigger("click")},1e3);setInterval(function(){SocketTrunkTotals();DataTableData()},1e3)});var AllTrunksActiveCalls=[],AllTrunksInfo=[],SelectedTrunk="-1",VisibleTrunks=[],ChartList=[],_isStart=!0,SignalrConnection,MessageProxy;$(document).on("click",".TrunkDetailButton",function(){var n=$(this).attr("data-item"),t=$(this).attr("data-name");SelectedTrunk=n;$("#TableTitle").html(t)});$("#ChangeTrunkView").click(function(){var n=[];if($("#trunk-modal-container input[type=checkbox]").each(function(){this.checked&&n.push($(this).val().toString())}),n.length==0)return toastr.error(Localization.EnAz1SecimYap,Localization.Error),!1;if(n.length>3)return toastr.error(Localization.EnCok3SecimYap,Localization.Error),!1;$("#default-modal").modal("hide");VisibleTrunks=n;ChartList=[];StartTrunk()});