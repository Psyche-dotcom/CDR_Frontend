function closeNav(){$("#callDetail").fadeOut();$("body").removeClass("appointment-before");audio!=undefined&&(audio.destroy(),audio=undefined)}function DrawAudio(n){if(RecordingCounts)try{var t=n;if(t==null||t.audioBase64==null||t.audioBase64=="")return $("#sound-recording").html('<div class="detail-loading"> <div class="detail-loading-content"><p>'+Localization.RecordingNotFound+"<\/p><\/div><\/div>"),!1;if(t.audioPath==$("#audiourl").html()){$("#plyr-audio-player").html('<source src="data:audio/wav;base64,'+t.audioBase64+'"/>');audio=WaveSurfer.create({container:document.querySelector("#waveform"),waveColor:"#A3F4FF",progressColor:"#00E0FF",skipLength:15,plugins:[WaveSurfer.cursor.create({showTime:!0,opacity:1,customShowTimeStyle:{"background-color":"#000",color:"#fff",padding:"2px","font-size":"10px"}})],fillParent:!1,scrollParent:!0,scrollSpeed:3});audio.load("data:audio/wav;base64,"+t.audioBase64);audio.on("audioprocess",function(){if(audio.isPlaying()){var n=audio.getDuration(),t=audio.getCurrentTime();$("#TimeCurrent").html(new Date(parseInt(t.toFixed(0)*1e3)).toISOString().substr(11,8));$("#TimeTotal").html(new Date(parseInt(n.toFixed(0)*1e3)).toISOString().substr(11,8))}});audio.on("ready",function(){audio.drawBuffer();audio.setVolume(.4);document.querySelector("#volume").value=audio.backend.getVolume();var n=document.querySelector("#volume"),t=function(n){audio.setVolume(n.target.value)};n.addEventListener("input",t);n.addEventListener("change",t)});audio.on("finish",function(){$(".audio-stop-button").css("display","none");$(".audio-play-button").css("display","block");$(".playpausebutton").removeClass("starting")});audio.on("error",function(){$("#sound-recording").html('<div class="alert alert-danger">'+Localization.AudioRecordingsVoiceRecord+'<\/div><a class="btn btn-success recording-download-button" style="display: inline-block; font-size: 15px; padding: 10px; color: #fff;"><i class="ft-download" style="vertical-align:top; margin-left:5px; margin-right:5px;"><\/i> '+Localization.RecordingDownload+"<\/a>");detailTempBase64=t.audioBase64});$(".detail-loading").remove()}}catch(i){$("#sound-recording").html('<div class="detail-loading"> <div class="detail-loading-content"><p>'+Localization.RecordingNotFound+"<\/p><\/div><\/div>")}}function b64toBlob(n,t,i){var e,o,r,f,s,u,h;for(t=t||"",i=i||512,e=atob(n),o=[],r=0;r<e.length;r+=i){for(f=e.slice(r,r+i),s=new Array(f.length),u=0;u<f.length;u++)s[u]=f.charCodeAt(u);h=new Uint8Array(s);o.push(h)}return new Blob(o,{type:t})}var audio,detailTempBase64;$(document).on("click",".CallDetailsButton",function(){$("#callDetail").fadeIn();$("body").addClass("appointment-before");$("#callDetail .sidebar-content").html('<img src="/app-assets/images/loading.gif" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);width:64px;height:64px;" />');var n=$(this).attr("data-type");$.post("/data/call-details",{CallId:n},function(n){if($("#callDetail .sidebar-content").html(n),RecordingCounts){var t=$("#audiourl").html();t!=undefined&&$.ajax({xhr:function(){var n=new window.XMLHttpRequest;return n.addEventListener("progress",function(n){$("#xhrInfo").html((n.loaded/1e6).toFixed(1)+" Mb")},!1),n},headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",url:"http://"+$("#IpAddress").val()+":8899/api/Audio",data:JSON.stringify({AudioPath:t}),dataType:"json",contentType:"application/json;",success:function(n){DrawAudio(n)},error:function(){$("#sound-recording").html('<div class="detail-loading"> <div class="detail-loading-content"><p>'+Localization.RecordingNotFound+"<\/p><\/div><\/div>")}})}})});$("body").click(function(n){var t=$(n.target);$("body").hasClass("appointment-before")&&(t.is(".appointment-detail")||t.is(".close-appointment")||t.closest(".appointment-detail").length||t.closest(".close-appointment").length||closeNav())});$(document).on("click",".playpausebutton",function(){$(".playpausebutton").hasClass("starting")?($(".playpausebutton").removeClass("starting"),$(".audio-stop-button").css("display","none"),$(".audio-play-button").css("display","block")):($(".playpausebutton").addClass("starting"),$(".audio-stop-button").css("display","block"),$(".audio-play-button").css("display","none"))});$(document).on("click",".recording-download-button",function(){var r=b64toBlob(detailTempBase64,"audio/wav",512),n=document.createElement("a"),i,t;window.URL&&window.Blob&&"download"in n&&window.atob&&(i=r,t=window.URL.createObjectURL(i),n.href=t,n.download=$("#RecordingFileName").val(),n.click(),window.URL.revokeObjectURL(t));console.clear()});